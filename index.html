<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokeApi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
</head>

<body>
    
    <div class="container mb-3">
        <div class="card" style="width: 18rem;">
            <img class="card-img-top d-none" src="" alt="Card image cap" data-shiny-url="">
            <div class="card-body">
                <h5 class="card-title" style=" text-transform: capitalize;">Lorepokemon</h5>
                <a href="#" class="btn btn-success">Change to Shiny</a>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="input-group mb-3">
            <span class="input-group-text" id="selected-pokemon-label">Which pokemon do you want to display?</span>
            <select id="select-pokemon" class="form-select" aria-label="selected pokemon" aria-describedby="selected-pokemon-label">
                <option selected>Select one pokemon</option>
                <option value="pikachu">Pikachu</option>
                <option value="charmander">Charmander</option>
                <option value="luxio">Luxio</option>
            </select>
        </div>

        <div class="input-group mb-3">
            <span class="input-group-text" id="selected-pokemon-label">Hasta que pokemon quieres cargar??</span>            
            <input class="hasta" type="number" value='10'>
        </div>        
    </div>
</body>
<script>
    // Configuracion del estado de la aplicación
    let state = {
        selector: document.querySelector('#select-pokemon'),
        name: document.querySelector('.card-title'),
        img: document.querySelector('.card-img-top'),
        btn: document.querySelector('.btn'),        
        hasta: document.querySelector('.hasta'),        
        poke_number: 10,
        poke_options:[],
        data: ''
    }

    // Al cargar la pagina llenamos el select de pokemons
    window.addEventListener('load', async function(){
        pokeOptions();
    })

    // 1. Cuando cambie el valor del selector, tenemos que detectar que opción hemos escogido. Probad que sois capaces de recuperar el valor seleccionado por el usuario con un console.log    
    state.selector.addEventListener('change', async function(event){
        let pokemon = state.selector.value
        let url = `https://pokeapi.co/api/v2/pokemon/${pokemon}`;
        state.selector.disabled = true;

        let respuesta = await fetch(url);
        let json = await respuesta.json();

        state.selector.disabled = false
        console.log(json);

        state.name.innerHTML = json.name;
        state.img.classList.remove('d-none');
        state.img.src = json.sprites.front_default;

        state.data = json;        
    })

    state.hasta.addEventListener('input',function(){
        state.poke_number = state.hasta.value;
        pokeOptions();
    })

    state.btn.addEventListener('click', function(){        
        state.img.src = state.data.sprites.front_shiny
    })

    async function pokeOptions(){
        let url = `https://pokeapi.co/api/v2/pokemon?limit=${state.poke_number}`
        let respuesta = await fetch(url);
        let json = await respuesta.json();

        console.log("Carga principal: ", json);

        state.selector.innerHTML = "";

        json.results.forEach(element=>{            
            state.selector.insertAdjacentHTML('beforeend',`
                <option value='${element.name}'>${element.name}</option>
            `)            
        })
    }

    // 2. En función de la opción escogida, 'montaremos' una URL
    // https://pokeapi.co/api/v2/pokemon/pikachu
    // https://pokeapi.co/api/v2/pokemon/luxio

    // 3. Utilizar la función fetch para hacer la llamada a esa URL
    // y procesar los datos. Significa, asignar al <h5> del DOM el nombre del pokemon que hemos recuperado de la llamada. Y en la etiqueta <img> debemos establecer el atricuto 'src' con el valor de la URL donde se ubica la imagen del pokemon

</script>

</html>